// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var resetValidation, validateEmail, validateGroupRequired, validateRequired;
    $('input#favorite-beer-other').on('click', function() {
      var otherText;
      otherText = $('#favorite-beer-other-text');
      $(otherText).prop('disabled', !$(otherText).prop('disabled'));
      return $(otherText).focus();
    });
    $('#reservation-modal').on('shown.bs.modal', function() {
      return $('input#name').focus();
    });
    $('#newsletter-modal').on('shown.bs.modal', function() {
      return $('input#newsletter-email').focus();
    });
    $('#js-reservation-form input, #js-newsletter-form input').on('keydown', function(e) {
      if (e.keyCode === 13) {
        return $(this).submit();
      }
    });
    $('#js-reservation-submit').on('click', function(e) {
      e.preventDefault();
      return $('#js-reservation-form').submit();
    });
    $('#js-reservation-form').on('submit', function(e) {
      e.preventDefault();
      resetValidation('#js-reservation-form');
      validateRequired('input');
      validateRequired('select', false);
      validateGroupRequired();
      validateEmail('#js-reservation-form input[data-validate-email]');
      if (!$('#js-reservation-form .form-group').hasClass('has-error')) {
        return $.ajax({
          url: $('#js-reservation-form').prop('action'),
          data: $(this).serialize(),
          type: 'POST',
          dataType: 'jsonp'
        }).always(function() {
          $('#js-reservation-form').addClass('hidden');
          $('#js-reservation-submit').addClass('hidden');
          return $('#js-reservation-thanks').removeClass('hidden');
        });
      }
    });
    $('#js-newsletter-submit').on('click', function(e) {
      e.preventDefault();
      return $('#js-newsletter-form').submit();
    });
    $('#js-newsletter-form').on('submit', function(e) {
      e.preventDefault();
      $('#js-newsletter-error').addClass('hidden');
      resetValidation('#js-newsletter-form');
      validateEmail('#js-newsletter-form input[data-validate-email]');
      if (!$('#js-newsletter-form .form-group').hasClass('has-error')) {
        return $.ajax({
          url: $('#js-newsletter-form').prop('action'),
          data: $(this).serialize(),
          type: 'POST',
          dataType: 'jsonp'
        }).done(function(data) {
          if (data.result === 'error') {
            return $('#js-newsletter-error').removeClass('hidden');
          } else {
            $('#js-newsletter-form').addClass('hidden');
            $('#js-newsletter-submit').addClass('hidden');
            return $('#js-newsletter-thanks').removeClass('hidden');
          }
        });
      }
    });
    resetValidation = function(selector) {
      var container;
      container = $("" + selector + " .form-group");
      $(container).removeClass('has-error');
      $(container).removeClass('has-feedback');
      $(container).children('.form-control-feedback').remove();
      return $(container).children('.validation-message').remove();
    };
    validateRequired = function(selector, showFeedback) {
      if (showFeedback == null) {
        showFeedback = true;
      }
      return $("#js-reservation-form " + selector + "[data-required]").map(function() {
        var formGroup;
        if (!$(this).val()) {
          formGroup = $(this).parents('.form-group');
          $(formGroup).addClass('has-error');
          $(formGroup).addClass('has-feedback');
          if (showFeedback && !$(formGroup).find('form-control-feedback').length) {
            return $(formGroup).append('<span class="glyphicon glyphicon-remove form-control-feedback"> </span>');
          }
        }
      });
    };
    validateGroupRequired = function() {
      return $('#js-reservation-form input[data-required-group]').map(function() {
        var group;
        group = $(this).data('required-group');
        if (!$("input[name=\"" + group + "\"]:checked").val()) {
          $(this).parents('.form-group').addClass('has-error');
          return $(this).parents('.form-group').addClass('has-feedback');
        }
      });
    };
    return validateEmail = function(selector) {
      return $(selector).map(function() {
        var regex;
        regex = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!regex.test($(this).val())) {
          $(this).parents('.form-group').addClass('has-error');
          $(this).parents('.form-group').addClass('has-feedback');
          if (!$(this).parents('.form-group').find('form-control-feedback').length) {
            $(this).parents('.form-group').append('<span class="glyphicon glyphicon-remove form-control-feedback"> </span>');
          }
          if (!$(this).parents('.form-group').find('.validation-message').length) {
            return $(this).parents('.form-group').append('<span class="validation-message help-block"> Must be a valid email address. </span>');
          }
        }
      });
    };
  });

}).call(this);
